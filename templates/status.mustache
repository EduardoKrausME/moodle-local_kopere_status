{{!
    This file is part of Moodle - https://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_kopere_status/status

    Example context (json):
    {
        "title": "Report name"
    }
}}

<div class="sb-container">
    <header class="sb-header">
        <h1 class="sb-title">{{{title}}}</h1>
        <span class="sb-overall sb-{{{overall}}}">{{{overall_label}}}</span>
    </header>

    <section>
        {{#statusmodules}}
            <div class="sb-card">
                <div class="sb-card-head">
                    <span class="sb-dot up"></span>
                    <h3>{{{name}}}</h3>
                </div>
                <div class="sb-hoursline" role="list" aria-label="Últimas horas">
                    {{#status.hours}}
                        <span class="sb-hourbar {{cls}}"
                              title="{{{timecreated}}} - {{{pct}}}%"
                              data-timecreated="{{{timecreated}}}"
                              data-pct="{{{pct}}}"></span>
                    {{/status.hours}}
                </div>

                {{#last_log}}
                    <p class="sb-metric"><strong>{{{latencyms}}} ms</strong></p>
                    <div class="d-flex gap-3 align-items-center">
                        <p class="sb-sub">
                            {{#status}}
                                {{#str}}up, local_kopere_status{{/str}}
                            {{/status}}
                            {{^status}}
                                {{#str}}down, local_kopere_status{{/str}}
                            {{/status}}
                            ·
                            {{#httpcode}}
                                HTTP {{{httpcode}}}
                            {{/httpcode}}
                        </p>
                        <p class="sb-time">{{#str}}lastcheck, local_kopere_status{{/str}}: {{{timecreated}}}</p>
                    </div>
                {{/last_log}}
                {{^last_log}}
                    <p class="sb-sub">{{#str}}nodata, local_kopere_status{{/str}}</p>
                {{/last_log}}
            </div>
        {{/statusmodules}}
    </section>
</div>

<!-- Modal -->
<div class="hoursline-modal" id="hoursline-modal"></div>

<script>
    const spans = document.querySelectorAll(".sb-hoursline .sb-hourbar");
    const modal = document.getElementById("hoursline-modal");

    spans.forEach(span => {
        span.addEventListener("mouseenter", () => {
            const timecreated = span.getAttribute("data-timecreated");
            const pct = span.getAttribute("data-pct");
            const extraclass = span.getAttribute("class").replace("sb-hourbar");
            modal.innerHTML = `<span class='time'>${timecreated}</span><span class="pct ${extraclass}">${pct}%<span>`;
            modal.style.display = "block";

            // posição acima do item
            const rect = span.getBoundingClientRect();
            modal.style.left = rect.left + window.scrollX + "px";
            modal.style.top = rect.top + window.scrollY - modal.offsetHeight - 8 + "px"; // 8px de espaço
        });

        span.addEventListener("mouseleave", () => {
            modal.style.display = "none";
        });
    });
</script>
